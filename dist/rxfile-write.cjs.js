/*!
 * rxfile-write
 * version: 0.0.8
 * repo: https://github.com/cheere/rxfile-write
 * build: 2022-04-02 15:44:06
 */
"use strict";var t=require("fs"),e=require("path");function n(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var r=n(t),i=n(e);const o={};function c(t){return!!(t&&t.indexOf("rxfile-write.js")>=0)}o.error=function(t,e){if(e=e||"",t){if("object"==typeof t)return t}else t="unknow";const n=new Error("RxfileWrite-error=> "+e+" -> "+t);let r=n.stack;if(r){const t=r.split("at"),e=t.length,i=[],o=[],s=[];let f=!0;for(let n=0;n<e;n+=2){let r=t[n]||"",u=n+1<e?t[n+1]:"";0!==n&&(r=r?"at"+r:"",u=u?"at"+u:"");const l=u?u+r:r;0===n?(i.push(r),u&&o.push("at"+u)):r&&(c(r)||c(u))?l&&o.push(l):f?(f=!1,r&&o.push(r),u&&s.push(u)):l&&s.push(l)}const u=o.reverse(),l=i.concat(u).concat(s).join("");n.stack=l}return n};const s={exists:function(t){const e=this;return new Promise(((n,i)=>{e.isString(t)?r.default.stat(t,((t,r)=>{t?i(t):r.isDirectory()?n({dir:!0,file:!1}):r.isFile()?n({dir:!1,file:!0}):i(e.error("RxfileWrite-exist=> stats not dir/file"))})):i(e.error("RxfileWrite-exist=> path undefined or null"))}))},existsSync:function(t){const e=this;if(!t)return e.error("RxfileWrite-existsSync=> path undefined"),{dir:!1,file:!1};try{const n=r.default.statSync(t);return n.isDirectory()?{dir:!0,file:!1}:n.isFile()?{dir:!1,file:!0}:(e.error("RxfileWrite-exist=> stats not dir/file"),{dir:!1,file:!1})}catch(t){return e.error("RxfileWrite-exist=> stats not dir/file"),{dir:!1,file:!1}}}},f={};f.read=function(t){const e=this;return new Promise(((n,i)=>{e.exists(t).then((()=>{(function(t){return new Promise(((e,n)=>{r.default.readFile(t,"utf-8",((t,r)=>{t?n(t):e(r)}))}))})(t).then((t=>{n(t)})).catch((t=>{i(t)}))})).catch((t=>{i(t)}))}))};const u={};u.cp=function(t,e){const n=this;return new Promise(((i,o)=>{n.exists(t).then((c=>{c.dir?n.loopCp(t,e).then(i).catch(o):c.file?function(t,e){return new Promise(((n,i)=>{r.default.copyFile(t,e,(function(t){t?i(t):n("")}))}))}(t,e).then((()=>{i("")})).catch((t=>{o(t)})):o("fileInfo type unknow")})).catch((t=>{o(t)}))}))},u.cpSync=function(t,e){const n=this,i=this.existsSync(t);return i.file?function(t,e){try{r.default.copyFileSync(t,e)}catch(t){return!1}return!0}(t,e):!!i.dir&&n.loopCpSync(t,e)};const l={};function a(t){try{const e=r.default.statSync(t);e.isDirectory()||e.isFile()||r.default.mkdirSync(t)}catch(e){r.default.mkdirSync(t)}}l.loopCpSync=function(t,e){const n=this,o=n.existsSync(t);let c=!1;if(o.dir){a(e);let o=e;r.default.readdirSync(t).forEach((s=>{const f=i.default.resolve(t,s),u=r.default.statSync(f);if(o=i.default.resolve(e,s),u.isDirectory())return n.loopCpSync(f,o);u.isFile()&&(c=n.cpSync(f,o))}))}else c=n.cpSync(t,e);return c},l.loopCp=function(t,e){const n=this;return new Promise(((o,c)=>{n.exists(t).then((s=>{if(s.dir){a(e);let c=e,s="";r.default.readdirSync(t).forEach((o=>{const f=i.default.resolve(t,o),u=r.default.statSync(f);let l=!1;c=i.default.resolve(e,o),u.isDirectory()?l=n.loopCpSync(f,c):u.isFile()&&(l=n.cpSync(f,c)),l&&(s&&(s+="\n"),s+="error-loopCp: file="+o+"__fullPath="+f)})),o(s)}else s.file?n.cp(t,e).then(o).catch(c):c("fileInfo type unknow")})).catch((t=>{c(t)}))}))};const d={write:function(t,e){return this.writeTo(t,e)},writeSync:function(t,e){S(t,e)},writeAppend:function(t,e){return this.writeTo(t,e,!0)},writeAppendSync:function(t,e){S(t,e,!0)}};d.writeTo=function(t,e,n=!1){return new Promise(((o,c)=>{let s=t;try{s=i.default.dirname(t)}catch(t){console.log("writeTo -> path.dirname error:",t)}this.isData(e)?this.exists(s).then((()=>{p(t,e,n).then(o).catch(c)})).catch((()=>{(function(t){return new Promise(((e,n)=>{r.default.mkdir(t,{mode:h,flag:"w+"},(function(t){t?n(t):e()}))}))})(t).then((()=>{p(t,e,n).then(o).catch(c)})).catch(c)})):c(this.error("text not `string or buffer` ","writeTo"))}))};const h=parseInt("0755",8),y=parseInt("0666",8);function p(t,e,n=!1){let i="w+",o=r.default.writeFile;return n&&(o=r.default.appendFile,i="as+"),new Promise(((n,r)=>{o(t,e,{encoding:"utf8",mode:y,flag:i},(function(t){t?r(t):n()}))}))}function S(t,e,n=!1){let i="w+",o=r.default.writeFileSync;n&&(o=r.default.appendFileSync,i="as+");try{o(t,e,{encoding:"utf8",mode:y,flag:i})}catch(t){console.error(t)}}const w={};function x(t){let e=[];r.default.existsSync(t)&&(e=r.default.readdirSync(t),e.forEach((e=>{const n=t+"/"+e;r.default.statSync(n).isDirectory()?x(n):r.default.unlinkSync(n)})),r.default.rmdirSync(t))}w.remove=function(t){const e=this;return new Promise(((n,i)=>{e.exists(t).then((()=>{(function(t){return new Promise(((e,n)=>{try{r.default.statSync(t).isDirectory()?x(t):r.default.unlinkSync(t),e()}catch(t){console.log("RxfileWrite-remove=> error=",t),n(t)}}))})(t).then((()=>{n()})).catch((t=>{i(t)}))})).catch((t=>{i(t)}))}))};var m="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function P(t){return null!=t&&(!!t._isBuffer||g(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&g(t.slice(0,0))}(t))}function g(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}void 0===m.TYPED_ARRAY_SUPPORT||m.TYPED_ARRAY_SUPPORT;const F={isUndef:function(t){return null==t},isTrue:function(t){return!0===t},isFalse:function(t){return!1===t},isString:function(t){return!(!t||"string"!=typeof t)},isObject:function(t){return!(!t||"object"!=typeof t)},isData:function(t){return!(!t||"string"!=typeof t&&!P(t))}},R=Object.assign(s,f,u,l,d,w,F),v=Object.assign(o,R);v.version='"0.0.8"',module.exports=v;
