/*!
 * rxfile-write
 * version: 0.0.7
 * repo: https://github.com/cheere/rxfile-write
 * build: 2022-01-13 10:19:43
 */
"use strict";var t=require("fs"),e=require("path");function n(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var r=n(t),i=n(e);const o={};function s(t){return!!(t&&t.indexOf("rxfile-write.js")>=0)}o.errorShow=!0,o.error=function(t,e){if(!this.errorShow)return"";if(e=e||"",t){if("object"==typeof t)return t}else t="unknow";const n=new Error("RxfileWrite-error=> "+e+" -> "+t);let r=n.stack;if(r){const t=r.split("at"),e=t.length,i=[],o=[],c=[];let u=!0;for(let n=0;n<e;n+=2){let r=t[n]||"",f=n+1<e?t[n+1]:"";0!==n&&(r=r?"at"+r:"",f=f?"at"+f:"");const l=f?f+r:r;0===n?(i.push(r),f&&o.push("at"+f)):r&&(s(r)||s(f))?l&&o.push(l):u?(u=!1,r&&o.push(r),f&&c.push(f)):l&&c.push(l)}const f=o.reverse(),l=i.concat(f).concat(c).join("");n.stack=l}return n};const c={exists:function(t){const e=this;return new Promise(((n,i)=>{e.isString(t)?r.default.stat(t,((t,r)=>{t?i(t):r.isDirectory()?n({dir:!0,file:!1}):r.isFile()?n({dir:!1,file:!0}):i(e.error("RxfileWrite-exist=> stats not dir/file"))})):i(e.error("RxfileWrite-exist=> filePath undefined or null"))}))},existsSync:function(t){const e=this;if(!e.isString(t))return e.error("RxfileWrite-existsSync=> filePath undefined"),{dir:!1,file:!1};try{const n=i.default.dirname(t);if(!r.default.existsSync(n))return{dir:!1,file:!1};const o=r.default.statSync(t);return o.isDirectory()?{dir:!0,file:!1}:o.isFile()?{dir:!1,file:!0}:(e.error("RxfileWrite-exist=> stats not dir/file"),{dir:!1,file:!1})}catch(t){return e.errorShow&&console.log(this.error(t,"exists try-catch error")),{dir:!1,file:!1}}}},u={};u.read=function(t){const e=this;return new Promise(((n,i)=>{e.exists(t).then((()=>{(function(t){return new Promise(((e,n)=>{r.default.readFile(t,"utf-8",((t,r)=>{t?n(t):e(r)}))}))})(t).then(n).catch(i)})).catch((t=>{i(t)}))}))};const f={};f.cp=function(t,e){const n=this;return new Promise(((i,o)=>{n.exists(t).then((()=>{(function(t,e){return new Promise(((n,i)=>{r.default.copyFile(t,e,(function(t){t?i(t):n()}))}))})(t,e).then(i).catch(o)})).catch((t=>{o(t)}))}))},f.cpSync=function(t,e){return!!this.existsSync(t).file&&function(t,e){try{r.default.copyFileSync(t,e)}catch(t){return console.error(t),!1}return!0}(t,e)};const l={write:function(t,e){return this.writeTo(t,e)},writeSync:function(t,e){y(this,t,e)},writeAppend:function(t,e){return this.writeTo(t,e,!0)},writeAppendSync:function(t,e){y(this,t,e,!0)}};l.writeTo=function(t,e,n=!1){const o=this;return new Promise(((s,c)=>{const u=i.default.dirname(t);this.isData(e)?o.exists(u).then((()=>{h(t,e,n).then(s).catch(c)})).catch((()=>{(function(t){return new Promise(((e,n)=>{r.default.mkdir(t,{mode:a,flag:"w+"},(function(t){t?n(t):e()}))}))})(u).then((()=>{h(t,e,n).then(s).catch(c)})).catch(c)})):c(this.error("text not `string or buffer` ","writeTo"))}))};const a=parseInt("0755",8),d=parseInt("0666",8);function h(t,e,n=!1){let i="w+",o=r.default.writeFile;return n&&(o=r.default.appendFile,i="as+"),new Promise(((n,r)=>{o(t,e,{encoding:"utf8",mode:d,flag:i},(function(t){t?r(t):n()}))}))}function y(t,e,n,o=!1){let s=!0,c="w+",u=r.default.writeFileSync;o&&(u=r.default.appendFileSync,c="as+");try{const r=i.default.dirname(e);console.log("dirPath=",r);t.mkdirsSync(r)?u(e,n,{encoding:"utf8",mode:d,flag:c}):s=!1}catch(t){s=!1,console.error(t)}return s}const p={};p.remove=function(t){const e=this;return new Promise(((n,i)=>{e.exists(t).then((()=>{(function(t,e){return new Promise(((n,i)=>{try{r.default.statSync(e).isDirectory()?t.deleteDir(e):r.default.unlinkSync(e),n()}catch(t){i(t)}}))})(e,t).then(n).catch(i)})).catch((t=>{i(t)}))}))};const S={removeSync:function(t){const e=this.existsSync(t);e.dir?this.deleteDir(t):e.file&&r.default.unlinkSync(t)}};var w="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function m(t){return null!=t&&(!!t._isBuffer||x(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&x(t.slice(0,0))}(t))}function x(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}void 0===w.TYPED_ARRAY_SUPPORT||w.TYPED_ARRAY_SUPPORT;const P={isUndef:function(t){return null==t},isTrue:function(t){return!0===t},isFalse:function(t){return!1===t},isString:function(t){return!(!t||"string"!=typeof t)},isObject:function(t){return!(!t||"object"!=typeof t)},isData:function(t){return!!(this.isUndef(t)||"string"==typeof t||t&&m(t))},deleteDir:function(t){let e=[];r.default.existsSync(t)&&(e=r.default.readdirSync(t),e.forEach((e=>{const n=t+"/"+e;r.default.statSync(n).isDirectory()?this.deleteDir(n):r.default.unlinkSync(n)})),r.default.rmdirSync(t))},mkdirs:function(t,e){this.exists(t).then((n=>{n.dir?e&&e():this.mkdirs(i.default.dirname(t),(()=>{r.default.mkdir(t,e)}))}))},mkdirsSync:function(t){return!!r.default.existsSync(t)||(this.mkdirsSync(i.default.dirname(t))?(r.default.mkdirSync(t),!0):void 0)}},g=Object.assign(c,u,f,l,p,S,P),k=Object.assign(o,g);k.version='"0.0.7"',module.exports=k;
